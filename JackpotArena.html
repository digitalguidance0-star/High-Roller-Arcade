<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé∞ JACKPOT ARENA</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&family=Russo+One&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #FFD700;
    --gold2: #FFA500;
    --neon-pink: #FF2D78;
    --neon-cyan: #00F5FF;
    --neon-green: #39FF14;
    --neon-purple: #BF00FF;
    --dark: #050510;
    --dark2: #0A0A1E;
    --dark3: #0F0F2E;
    --panel: rgba(10,10,40,0.95);
    --border: rgba(0,245,255,0.3);
    --text: #E0E8FF;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'Share Tech Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
    cursor: crosshair;
  }

  /* Scanlines overlay */
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.15) 2px,
      rgba(0,0,0,0.15) 4px
    );
    pointer-events: none;
    z-index: 9999;
  }

  /* Ambient glow background */
  body::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background:
      radial-gradient(ellipse 60% 40% at 20% 30%, rgba(0,245,255,0.06) 0%, transparent 70%),
      radial-gradient(ellipse 50% 60% at 80% 70%, rgba(255,45,120,0.06) 0%, transparent 70%),
      radial-gradient(ellipse 80% 50% at 50% 100%, rgba(191,0,255,0.08) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  #app { position: relative; z-index: 1; max-width: 1400px; margin: 0 auto; padding: 10px; }

  /* ===== HEADER ===== */
  #header {
    text-align: center;
    padding: 16px 10px 10px;
    position: relative;
  }

  .title-main {
    font-family: 'Russo One', sans-serif;
    font-size: clamp(2rem, 5vw, 3.8rem);
    letter-spacing: 0.08em;
    background: linear-gradient(90deg, var(--neon-cyan), var(--gold), var(--neon-pink), var(--neon-cyan));
    background-size: 300% 100%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: titleShift 4s linear infinite;
    text-shadow: none;
    filter: drop-shadow(0 0 20px rgba(0,245,255,0.5));
    line-height: 1;
  }

  @keyframes titleShift {
    0% { background-position: 0% 50%; }
    100% { background-position: 300% 50%; }
  }

  .title-sub {
    font-family: 'Orbitron', monospace;
    font-size: 0.75rem;
    letter-spacing: 0.5em;
    color: var(--gold);
    opacity: 0.8;
    margin-top: 4px;
  }

  /* ===== STATS BAR ===== */
  #stats-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin: 8px 0;
    flex-wrap: wrap;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
  }

  .stat-label {
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    color: var(--neon-cyan);
    opacity: 0.7;
    text-transform: uppercase;
  }

  .stat-value {
    font-family: 'Orbitron', monospace;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--gold);
    text-shadow: 0 0 10px rgba(255,215,0,0.7);
  }

  #jackpot-pool {
    font-size: 1.4rem;
    color: var(--neon-pink);
    text-shadow: 0 0 15px rgba(255,45,120,0.8);
    animation: jackpotPulse 1.5s ease-in-out infinite;
  }

  @keyframes jackpotPulse {
    0%, 100% { text-shadow: 0 0 10px rgba(255,45,120,0.6); }
    50% { text-shadow: 0 0 25px rgba(255,45,120,1), 0 0 50px rgba(255,45,120,0.5); }
  }

  /* ===== ARENA ===== */
  #arena {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
    margin: 8px 0;
  }

  .player-slot {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    transition: border-color 0.3s, box-shadow 0.3s;
    position: relative;
    overflow: hidden;
  }

  .player-slot.is-human {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 20px rgba(0,245,255,0.2);
  }

  .player-slot.round-winner {
    border-color: var(--gold) !important;
    box-shadow: 0 0 30px rgba(255,215,0,0.6) !important;
    animation: winnerPulse 0.5s ease-in-out 4;
  }

  @keyframes winnerPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.03); }
  }

  .player-slot.loser { opacity: 0.7; }

  .slot-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    width: 100%;
  }

  .avatar {
    font-size: 2rem;
    line-height: 1;
    filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
    transition: transform 0.3s;
  }

  .player-name {
    font-family: 'Orbitron', monospace;
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: var(--neon-cyan);
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  .player-slot.is-human .player-name { color: var(--gold); }

  /* ===== REELS ===== */
  .reels-container {
    display: flex;
    gap: 4px;
    justify-content: center;
  }

  .reel {
    width: 42px;
    height: 42px;
    background: #000;
    border: 1px solid rgba(0,245,255,0.4);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
  }

  .reel-inner {
    position: absolute;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: top 0.05s linear;
  }

  .reel-symbol {
    width: 42px;
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.6rem;
    line-height: 1;
    flex-shrink: 0;
  }

  .reel.spinning .reel-inner { transition: none; }

  .reel::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.6) 100%);
    pointer-events: none;
    z-index: 2;
  }

  .reel-result {
    position: absolute;
    top: 50%;
    left: 0; right: 0;
    transform: translateY(-50%);
    text-align: center;
    font-size: 1.6rem;
    line-height: 42px;
    height: 42px;
    z-index: 3;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .reel.done .reel-result { opacity: 1; }

  /* ===== COMBO BADGE ===== */
  .combo-badge {
    font-family: 'Orbitron', monospace;
    font-size: 0.55rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 20px;
    letter-spacing: 0.1em;
    min-height: 18px;
    text-align: center;
    transition: all 0.3s;
  }

  .combo-none { background: transparent; color: transparent; }
  .combo-pair { background: rgba(0,245,255,0.15); color: var(--neon-cyan); border: 1px solid var(--neon-cyan); }
  .combo-triple { background: rgba(57,255,20,0.15); color: var(--neon-green); border: 1px solid var(--neon-green); }
  .combo-jackpot { background: rgba(255,215,0,0.2); color: var(--gold); border: 1px solid var(--gold); animation: jackpotPulse 0.8s infinite; }

  /* ===== ROUND SCORE ===== */
  .round-score {
    font-family: 'Orbitron', monospace;
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--text);
    min-height: 22px;
  }

  .total-score {
    font-size: 0.6rem;
    color: rgba(255,255,255,0.5);
    letter-spacing: 0.1em;
  }

  /* ===== REACTION ===== */
  .reaction {
    font-size: 1.2rem;
    min-height: 24px;
    transition: all 0.3s;
    animation: none;
  }

  .reaction.jump { animation: jump 0.5s ease-out; }
  .reaction.shake { animation: shake 0.5s ease-out; }

  @keyframes jump {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    75% { transform: translateX(4px); }
  }

  /* ===== RANK BADGE ===== */
  .rank-badge {
    position: absolute;
    top: 6px;
    right: 6px;
    font-family: 'Orbitron', monospace;
    font-size: 0.55rem;
    font-weight: 900;
    padding: 2px 5px;
    border-radius: 4px;
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.2);
  }

  .rank-1 { color: var(--gold); border-color: var(--gold); }
  .rank-2 { color: #C0C0C0; border-color: #C0C0C0; }
  .rank-3 { color: #CD7F32; border-color: #CD7F32; }

  /* ===== CONTROLS ===== */
  #controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 12px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 10px;
    margin: 8px 0;
    flex-wrap: wrap;
  }

  #spin-btn {
    font-family: 'Russo One', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 0.15em;
    padding: 14px 50px;
    background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple));
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 30px rgba(255,45,120,0.5), inset 0 1px 0 rgba(255,255,255,0.2);
    transition: all 0.2s;
    text-transform: uppercase;
  }

  #spin-btn::before {
    content: '';
    position: absolute;
    top: -50%; left: -60%;
    width: 40%; height: 200%;
    background: rgba(255,255,255,0.2);
    transform: skewX(-20deg);
    transition: left 0.4s;
  }

  #spin-btn:hover:not(:disabled)::before { left: 120%; }
  #spin-btn:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 0 50px rgba(255,45,120,0.8); }
  #spin-btn:active:not(:disabled) { transform: scale(0.97); }
  #spin-btn:disabled { opacity: 0.5; cursor: not-allowed; }

  #auto-btn {
    font-family: 'Orbitron', monospace;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 10px 20px;
    background: transparent;
    color: var(--neon-cyan);
    border: 1px solid var(--neon-cyan);
    border-radius: 6px;
    cursor: pointer;
    letter-spacing: 0.1em;
    transition: all 0.2s;
  }

  #auto-btn:hover { background: rgba(0,245,255,0.1); box-shadow: 0 0 15px rgba(0,245,255,0.4); }
  #auto-btn.active { background: rgba(0,245,255,0.2); box-shadow: 0 0 20px rgba(0,245,255,0.6); }

  .control-info {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.5);
    text-align: center;
    letter-spacing: 0.05em;
  }

  /* ===== ROUND RESULT BANNER ===== */
  #round-banner {
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', monospace;
    font-size: 0.9rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    border-radius: 6px;
    transition: all 0.4s;
    opacity: 0;
  }

  #round-banner.show {
    opacity: 1;
    background: rgba(255,215,0,0.1);
    border: 1px solid var(--gold);
    color: var(--gold);
    text-shadow: 0 0 15px rgba(255,215,0,0.8);
  }

  /* ===== LEADERBOARD ===== */
  #leaderboard-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin: 8px 0;
  }

  .lb-panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px;
  }

  .lb-title {
    font-family: 'Orbitron', monospace;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.25em;
    color: var(--neon-cyan);
    text-transform: uppercase;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .lb-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, var(--neon-cyan), transparent);
    opacity: 0.4;
  }

  .lb-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 6px;
    border-radius: 5px;
    margin-bottom: 4px;
    transition: background 0.3s;
  }

  .lb-row:hover { background: rgba(255,255,255,0.03); }
  .lb-row.lb-first { background: rgba(255,215,0,0.08); border: 1px solid rgba(255,215,0,0.3); }

  .lb-rank {
    font-family: 'Orbitron', monospace;
    font-size: 0.65rem;
    font-weight: 900;
    width: 22px;
    text-align: center;
  }

  .lb-avatar { font-size: 1rem; }

  .lb-name {
    flex: 1;
    font-size: 0.7rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .lb-score {
    font-family: 'Orbitron', monospace;
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--gold);
    text-shadow: 0 0 8px rgba(255,215,0,0.5);
  }

  .lb-wins {
    font-size: 0.65rem;
    color: var(--neon-green);
    min-width: 30px;
    text-align: right;
  }

  /* ===== JACKPOT HISTORY ===== */
  .hist-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    font-size: 0.65rem;
  }

  .hist-round { color: rgba(255,255,255,0.4); }
  .hist-winner { color: var(--neon-cyan); }
  .hist-prize { color: var(--gold); font-family: 'Orbitron', monospace; font-weight: 700; }

  /* ===== JACKPOT METER ===== */
  .jackpot-meter {
    margin-top: 6px;
    padding: 8px;
    background: rgba(0,0,0,0.3);
    border-radius: 6px;
    border: 1px solid rgba(255,45,120,0.3);
  }

  .meter-label {
    font-size: 0.6rem;
    color: var(--neon-pink);
    letter-spacing: 0.15em;
    margin-bottom: 4px;
  }

  .meter-bar-bg {
    height: 8px;
    background: rgba(255,45,120,0.1);
    border-radius: 4px;
    overflow: hidden;
  }

  .meter-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--neon-pink), var(--gold));
    border-radius: 4px;
    transition: width 0.5s ease-out;
    box-shadow: 0 0 10px rgba(255,45,120,0.7);
  }

  /* ===== OVERLAY / MATCH END ===== */
  #overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.92);
    z-index: 10000;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 20px;
    text-align: center;
  }

  #overlay.show { display: flex; }

  .overlay-title {
    font-family: 'Russo One', sans-serif;
    font-size: clamp(2rem, 6vw, 4rem);
    background: linear-gradient(90deg, var(--gold), var(--neon-pink), var(--gold));
    background-size: 200% 100%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: titleShift 2s linear infinite;
    filter: drop-shadow(0 0 30px rgba(255,215,0,0.5));
  }

  .overlay-champion {
    font-size: 5rem;
    animation: bounceIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  @keyframes bounceIn {
    0% { transform: scale(0); }
    70% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  .overlay-name {
    font-family: 'Orbitron', monospace;
    font-size: clamp(1.2rem, 3vw, 2rem);
    font-weight: 900;
    color: var(--gold);
    text-shadow: 0 0 30px rgba(255,215,0,0.8);
    letter-spacing: 0.2em;
  }

  .overlay-score {
    font-family: 'Orbitron', monospace;
    font-size: 1rem;
    color: var(--neon-cyan);
    letter-spacing: 0.1em;
  }

  .overlay-final-lb {
    background: var(--panel);
    border: 1px solid var(--gold);
    border-radius: 12px;
    padding: 16px 32px;
    min-width: 280px;
  }

  #replay-btn {
    font-family: 'Russo One', sans-serif;
    font-size: 1rem;
    letter-spacing: 0.2em;
    padding: 14px 40px;
    background: linear-gradient(135deg, var(--gold2), var(--gold));
    color: #000;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    box-shadow: 0 0 30px rgba(255,215,0,0.5);
  }

  #replay-btn:hover { transform: scale(1.05); box-shadow: 0 0 50px rgba(255,215,0,0.8); }

  /* ===== PARTICLES ===== */
  #particles {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 5000;
    overflow: hidden;
  }

  .particle {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    animation: particleFall linear forwards;
  }

  @keyframes particleFall {
    0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
  }

  /* ===== SPINNING ANIMATION OVERLAY ===== */
  .spin-flash {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    border-radius: 12px;
    background: rgba(0,245,255,0.05);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .player-slot.spinning-active .spin-flash { opacity: 1; }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 900px) {
    #arena { grid-template-columns: repeat(3, 1fr); }
    #leaderboard-section { grid-template-columns: 1fr; }
  }

  @media (max-width: 600px) {
    #arena { grid-template-columns: repeat(2, 1fr); }
    .reel { width: 36px; height: 36px; }
    .reel-symbol { width: 36px; height: 36px; font-size: 1.3rem; }
    .reel-result { font-size: 1.3rem; line-height: 36px; height: 36px; }
  }

  /* ===== LOBBY ===== */
  #lobby {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--dark);
    z-index: 9000;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lobby-box {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 40px;
    max-width: 500px;
    width: 90%;
    text-align: center;
  }

  .lobby-title {
    font-family: 'Russo One', sans-serif;
    font-size: 2.5rem;
    background: linear-gradient(90deg, var(--neon-cyan), var(--gold), var(--neon-pink));
    background-size: 200% 100%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: titleShift 3s linear infinite;
    filter: drop-shadow(0 0 20px rgba(0,245,255,0.4));
    margin-bottom: 8px;
  }

  .lobby-sub {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.4);
    letter-spacing: 0.2em;
    margin-bottom: 30px;
  }

  .avatar-select {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin: 16px 0;
  }

  .avatar-option {
    padding: 10px 6px;
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    background: rgba(0,0,0,0.3);
  }

  .avatar-option:hover { border-color: var(--neon-cyan); background: rgba(0,245,255,0.1); }
  .avatar-option.selected { border-color: var(--gold); background: rgba(255,215,0,0.1); box-shadow: 0 0 15px rgba(255,215,0,0.4); }

  .avatar-option .av-emoji { font-size: 1.8rem; display: block; }
  .avatar-option .av-name { font-size: 0.55rem; color: rgba(255,255,255,0.6); margin-top: 4px; }

  .rounds-select {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin: 12px 0;
  }

  .rounds-option {
    padding: 8px 16px;
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Orbitron', monospace;
    font-size: 0.8rem;
    background: rgba(0,0,0,0.3);
    color: var(--text);
    transition: all 0.2s;
  }

  .rounds-option:hover { border-color: var(--neon-pink); }
  .rounds-option.selected { border-color: var(--neon-pink); background: rgba(255,45,120,0.15); color: var(--neon-pink); box-shadow: 0 0 10px rgba(255,45,120,0.3); }

  .lobby-label {
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    color: var(--neon-cyan);
    text-transform: uppercase;
    margin-bottom: 8px;
    text-align: left;
  }

  #start-btn {
    font-family: 'Russo One', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 0.2em;
    padding: 16px 60px;
    background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple));
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 20px;
    box-shadow: 0 0 30px rgba(255,45,120,0.5);
    transition: all 0.2s;
    text-transform: uppercase;
    width: 100%;
  }

  #start-btn:hover { transform: scale(1.03); box-shadow: 0 0 50px rgba(255,45,120,0.8); }

  .name-input {
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(0,245,255,0.3);
    border-radius: 6px;
    color: var(--text);
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.9rem;
    padding: 8px 12px;
    width: 100%;
    outline: none;
    transition: border-color 0.2s;
    text-align: center;
    letter-spacing: 0.1em;
  }

  .name-input:focus { border-color: var(--neon-cyan); box-shadow: 0 0 10px rgba(0,245,255,0.3); }

  /* ===== ROUND PROGRESS ===== */
  .round-pips {
    display: flex;
    gap: 4px;
    align-items: center;
    justify-content: center;
  }

  .pip {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255,255,255,0.15);
    transition: all 0.3s;
  }

  .pip.done { background: var(--neon-green); box-shadow: 0 0 6px var(--neon-green); }
  .pip.current { background: var(--gold); box-shadow: 0 0 8px var(--gold); animation: jackpotPulse 1s infinite; }
</style>
</head>
<body>

<!-- PARTICLES -->
<div id="particles"></div>

<!-- LOBBY -->
<div id="lobby">
  <div class="lobby-box">
    <div class="lobby-title">üé∞ JACKPOT ARENA</div>
    <div class="lobby-sub">‚òÖ TOURNAMENT EDITION ‚òÖ</div>

    <div class="lobby-label">Your Name</div>
    <input class="name-input" id="player-name-input" value="PLAYER" maxlength="12" placeholder="Enter your name" />

    <div class="lobby-label" style="margin-top:16px;">Choose Your Avatar</div>
    <div class="avatar-select" id="avatar-select"></div>

    <div class="lobby-label">Rounds per Match</div>
    <div class="rounds-select" id="rounds-select">
      <div class="rounds-option selected" data-rounds="5">5</div>
      <div class="rounds-option" data-rounds="7">7</div>
      <div class="rounds-option" data-rounds="10">10</div>
    </div>

    <button id="start-btn">‚ö° START TOURNAMENT</button>
  </div>
</div>

<!-- MAIN APP -->
<div id="app">
  <div id="header">
    <div class="title-main">üé∞ JACKPOT ARENA</div>
    <div class="title-sub">‚òÖ TOURNAMENT EDITION ‚òÖ</div>
  </div>

  <div id="stats-bar">
    <div class="stat-item">
      <span class="stat-label">Round</span>
      <span class="stat-value" id="stat-round">1 / 5</span>
    </div>
    <div class="stat-item">
      <div class="round-pips" id="round-pips"></div>
    </div>
    <div class="stat-item">
      <span class="stat-label">üèÜ Jackpot Pool</span>
      <span class="stat-value" id="jackpot-pool" style="color:var(--neon-pink);text-shadow:0 0 15px rgba(255,45,120,0.8)">üí∞ 0</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Your Score</span>
      <span class="stat-value" id="stat-my-score">0</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Your Rank</span>
      <span class="stat-value" id="stat-my-rank">#1</span>
    </div>
  </div>

  <div id="arena"></div>

  <div id="round-banner"></div>

  <div id="controls">
    <button id="spin-btn">üé∞ SPIN ALL</button>
    <div style="display:flex;flex-direction:column;gap:6px;align-items:center">
      <button id="auto-btn">AUTO SPIN</button>
      <div class="control-info" id="auto-status">Manual mode</div>
    </div>
    <div style="display:flex;flex-direction:column;gap:4px;align-items:center">
      <div class="control-info" id="round-info">Click SPIN to begin Round 1</div>
    </div>
  </div>

  <div id="leaderboard-section">
    <div class="lb-panel">
      <div class="lb-title">üìä Leaderboard</div>
      <div id="leaderboard"></div>
    </div>
    <div class="lb-panel">
      <div class="lb-title">üèÖ Round History</div>
      <div id="history-list"></div>
      <div class="jackpot-meter">
        <div class="meter-label">JACKPOT METER</div>
        <div class="meter-bar-bg">
          <div class="meter-bar-fill" id="jackpot-meter-fill" style="width:0%"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MATCH END OVERLAY -->
<div id="overlay">
  <div class="overlay-champion" id="overlay-champion"></div>
  <div class="overlay-title" id="overlay-title">CHAMPION!</div>
  <div class="overlay-name" id="overlay-name"></div>
  <div class="overlay-score" id="overlay-score"></div>
  <div class="overlay-final-lb" id="overlay-lb"></div>
  <button id="replay-btn">üîÑ PLAY AGAIN</button>
</div>

<script>
// ===== GAME DATA =====
const SYMBOLS = [
  { emoji: 'üíé', name: 'Diamond',  value: 10, weight: 3 },
  { emoji: '7Ô∏è‚É£',  name: 'Seven',   value: 8,  weight: 5 },
  { emoji: 'üçí', name: 'Cherry',  value: 4,  weight: 15 },
  { emoji: 'üçã', name: 'Lemon',   value: 3,  weight: 15 },
  { emoji: '‚≠ê', name: 'Star',    value: 6,  weight: 8 },
  { emoji: 'üîî', name: 'Bell',    value: 5,  weight: 10 },
  { emoji: 'üçá', name: 'Grape',   value: 3,  weight: 15 },
  { emoji: 'üÉè', name: 'Joker',   value: 7,  weight: 5 },
];

const AI_CONFIGS = [
  { name: 'NOVA-X',   avatar: 'ü§ñ', color: '#FF6B6B', speed: 1.0 },
  { name: 'CYBER-7',  avatar: 'üëæ', color: '#A78BFA', speed: 0.8 },
  { name: 'GLITCH',   avatar: 'üëΩ', color: '#34D399', speed: 1.3 },
  { name: 'VORTEX',   avatar: 'ü¶æ', color: '#FBBF24', speed: 0.9 },
];

const AVATAR_OPTIONS = [
  { emoji: 'üé≠', name: 'Phantom' },
  { emoji: 'ü¶Å', name: 'Lion' },
  { emoji: 'üêâ', name: 'Dragon' },
  { emoji: '‚ö°', name: 'Thunder' },
  { emoji: 'üî•', name: 'Blaze' },
  { emoji: 'üåä', name: 'Surge' },
  { emoji: 'üíÄ', name: 'Reaper' },
  { emoji: 'üéØ', name: 'Ace' },
];

// ===== LOBBY =====
let selectedAvatarIdx = 0;
let selectedRounds = 5;
let playerName = 'PLAYER';

const avatarSelect = document.getElementById('avatar-select');
AVATAR_OPTIONS.forEach((av, i) => {
  const el = document.createElement('div');
  el.className = 'avatar-option' + (i === 0 ? ' selected' : '');
  el.innerHTML = `<span class="av-emoji">${av.emoji}</span><div class="av-name">${av.name}</div>`;
  el.addEventListener('click', () => {
    document.querySelectorAll('.avatar-option').forEach(e => e.classList.remove('selected'));
    el.classList.add('selected');
    selectedAvatarIdx = i;
  });
  avatarSelect.appendChild(el);
});

document.querySelectorAll('.rounds-option').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('.rounds-option').forEach(e => e.classList.remove('selected'));
    el.classList.add('selected');
    selectedRounds = parseInt(el.dataset.rounds);
  });
});

document.getElementById('start-btn').addEventListener('click', () => {
  playerName = document.getElementById('player-name-input').value.trim().toUpperCase() || 'PLAYER';
  document.getElementById('lobby').style.display = 'none';
  initGame();
});

// ===== GAME STATE =====
let players = [];
let totalRounds = 5;
let currentRound = 0;
let isSpinning = false;
let autoSpin = false;
let autoTimer = null;
let jackpotPool = 0;
let roundHistory = [];

function weightedRandom(symbols) {
  const totalWeight = symbols.reduce((s, sym) => s + sym.weight, 0);
  let r = Math.random() * totalWeight;
  for (const sym of symbols) {
    r -= sym.weight;
    if (r <= 0) return sym;
  }
  return symbols[symbols.length - 1];
}

function calcScore(reels) {
  const counts = {};
  for (const s of reels) {
    counts[s.name] = (counts[s.name] || 0) + 1;
  }
  let base = reels.reduce((s, r) => s + r.value, 0);
  let bonus = 0;
  let comboType = 'none';

  // Check triple
  for (const name in counts) {
    if (counts[name] === 3) {
      bonus = base * 3;
      comboType = reels[0].name === 'Diamond' ? 'jackpot' : 'triple';
      break;
    }
  }
  // Check pair
  if (comboType === 'none') {
    for (const name in counts) {
      if (counts[name] === 2) {
        bonus = base;
        comboType = 'pair';
        break;
      }
    }
  }

  return { total: base + bonus, bonus, comboType, base };
}

function initGame() {
  totalRounds = selectedRounds;
  jackpotPool = 500;
  currentRound = 0;
  roundHistory = [];
  isSpinning = false;

  // Create players array
  players = [];
  players.push({
    id: 0,
    name: playerName,
    avatar: AVATAR_OPTIONS[selectedAvatarIdx].emoji,
    isHuman: true,
    totalScore: 0,
    roundWins: 0,
    lastReels: null,
    lastScore: 0,
    lastCombo: 'none',
    color: '#00F5FF',
  });

  AI_CONFIGS.forEach((ai, i) => {
    players.push({
      id: i + 1,
      name: ai.name,
      avatar: ai.avatar,
      isHuman: false,
      totalScore: 0,
      roundWins: 0,
      lastReels: null,
      lastScore: 0,
      lastCombo: 'none',
      color: ai.color,
      speed: ai.speed,
    });
  });

  renderArena();
  renderLeaderboard();
  renderRoundPips();
  updateStats();
  document.getElementById('stat-round').textContent = `1 / ${totalRounds}`;
  document.getElementById('history-list').innerHTML = '';
  document.getElementById('round-banner').className = '';
  document.getElementById('round-info').textContent = 'Click SPIN to begin Round 1';

  document.getElementById('spin-btn').disabled = false;
  document.getElementById('auto-btn').classList.remove('active');
  document.getElementById('auto-status').textContent = 'Manual mode';
  autoSpin = false;
  if (autoTimer) clearTimeout(autoTimer);
}

// ===== ARENA RENDER =====
function renderArena() {
  const arena = document.getElementById('arena');
  arena.innerHTML = '';
  players.forEach((p, i) => {
    const slot = document.createElement('div');
    slot.className = 'player-slot' + (p.isHuman ? ' is-human' : '');
    slot.id = `slot-${p.id}`;
    slot.innerHTML = `
      <div class="spin-flash"></div>
      <div class="rank-badge" id="rank-${p.id}"></div>
      <div class="slot-header">
        <div class="avatar" id="avatar-${p.id}">${p.avatar}</div>
        <div class="player-name">${p.name}</div>
      </div>
      <div class="reels-container" id="reels-${p.id}">
        ${[0,1,2].map(r => `
          <div class="reel" id="reel-${p.id}-${r}">
            <div class="reel-inner" id="reel-inner-${p.id}-${r}"></div>
            <div class="reel-result" id="reel-result-${p.id}-${r}"></div>
          </div>
        `).join('')}
      </div>
      <div class="combo-badge combo-none" id="combo-${p.id}"></div>
      <div class="round-score" id="rscore-${p.id}">‚Äî</div>
      <div class="total-score">TOTAL: <span id="tscore-${p.id}">0</span></div>
      <div class="reaction" id="reaction-${p.id}"></div>
    `;
    arena.appendChild(slot);
  });
}

// ===== REEL ANIMATION =====
const SPIN_DURATION_BASE = 1200;

function spinReel(playerId, reelIdx, finalSymbol, delay, duration) {
  return new Promise(resolve => {
    const reelEl = document.getElementById(`reel-${playerId}-${reelIdx}`);
    const inner = document.getElementById(`reel-inner-${playerId}-${reelIdx}`);
    const resultEl = document.getElementById(`reel-result-${playerId}-${reelIdx}`);

    // Build scrolling strip
    const count = 20;
    inner.innerHTML = '';
    for (let i = 0; i < count; i++) {
      const sym = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
      const d = document.createElement('div');
      d.className = 'reel-symbol';
      d.textContent = sym.emoji;
      inner.appendChild(d);
    }
    // Add final at end
    const finalDiv = document.createElement('div');
    finalDiv.className = 'reel-symbol';
    finalDiv.textContent = finalSymbol.emoji;
    inner.appendChild(finalDiv);

    inner.style.top = '0px';
    reelEl.classList.add('spinning');
    resultEl.style.opacity = '0';

    setTimeout(() => {
      // Animate scroll
      const totalH = (count + 1) * 42;
      let start = null;
      function step(ts) {
        if (!start) start = ts;
        const progress = Math.min((ts - start) / duration, 1);
        // Ease-out
        const eased = 1 - Math.pow(1 - progress, 3);
        inner.style.top = `-${eased * (totalH - 42)}px`;
        if (progress < 1) {
          requestAnimationFrame(step);
        } else {
          inner.style.top = `-${totalH - 42}px`;
          reelEl.classList.remove('spinning');
          reelEl.classList.add('done');
          resultEl.textContent = finalSymbol.emoji;
          resultEl.style.opacity = '1';
          resolve();
        }
      }
      requestAnimationFrame(step);
    }, delay);
  });
}

// ===== SPIN PHASE =====
async function doSpin() {
  if (isSpinning || currentRound >= totalRounds) return;
  isSpinning = true;
  currentRound++;

  document.getElementById('spin-btn').disabled = true;
  document.getElementById('round-banner').className = '';
  document.getElementById('stat-round').textContent = `${currentRound} / ${totalRounds}`;
  document.getElementById('round-info').textContent = `Spinning Round ${currentRound}...`;

  // Update pips
  renderRoundPips();

  // Clear previous states
  players.forEach(p => {
    const slot = document.getElementById(`slot-${p.id}`);
    slot.classList.remove('round-winner', 'loser');
    slot.classList.add('spinning-active');
    document.getElementById(`reel-result-${p.id}-0`).style.opacity = '0';
    document.getElementById(`reel-result-${p.id}-1`).style.opacity = '0';
    document.getElementById(`reel-result-${p.id}-2`).style.opacity = '0';
    [0,1,2].forEach(r => {
      document.getElementById(`reel-${p.id}-${r}`).classList.remove('done');
    });
    document.getElementById(`combo-${p.id}`).className = 'combo-badge combo-none';
    document.getElementById(`combo-${p.id}`).textContent = '';
    document.getElementById(`reaction-${p.id}`).textContent = '';
    document.getElementById(`reaction-${p.id}`).className = 'reaction';
  });

  // Generate outcomes
  players.forEach(p => {
    p.lastReels = [weightedRandom(SYMBOLS), weightedRandom(SYMBOLS), weightedRandom(SYMBOLS)];
    const result = calcScore(p.lastReels);
    p.lastScore = result.total;
    p.lastCombo = result.comboType;
    jackpotPool += Math.floor(result.base * 0.1);
  });

  document.getElementById('jackpot-pool').textContent = `üí∞ ${jackpotPool.toLocaleString()}`;
  updateJackpotMeter();

  // Animate all reels
  const promises = [];
  players.forEach(p => {
    const duration = SPIN_DURATION_BASE * (p.speed || 1.0);
    p.lastReels.forEach((sym, ri) => {
      promises.push(spinReel(p.id, ri, sym, ri * 120, duration + ri * 200));
    });
  });

  await Promise.all(promises);

  // Remove spinning class
  players.forEach(p => {
    document.getElementById(`slot-${p.id}`).classList.remove('spinning-active');
  });

  // Show combos & scores
  players.forEach(p => {
    const comboEl = document.getElementById(`combo-${p.id}`);
    if (p.lastCombo === 'triple') { comboEl.className = 'combo-badge combo-triple'; comboEl.textContent = '‚ö° TRIPLE'; }
    else if (p.lastCombo === 'jackpot') { comboEl.className = 'combo-badge combo-jackpot'; comboEl.textContent = 'üíé JACKPOT'; }
    else if (p.lastCombo === 'pair') { comboEl.className = 'combo-badge combo-pair'; comboEl.textContent = '‚ú¶ PAIR'; }

    document.getElementById(`rscore-${p.id}`).textContent = `+${p.lastScore}`;
  });

  // Determine winner
  const maxScore = Math.max(...players.map(p => p.lastScore));
  const winners = players.filter(p => p.lastScore === maxScore);
  const roundWinner = winners[Math.floor(Math.random() * winners.length)];

  // Award jackpot
  const jackpotAward = Math.floor(jackpotPool * 0.4);
  roundWinner.totalScore += roundWinner.lastScore + jackpotAward;
  roundWinner.roundWins++;
  jackpotPool = Math.floor(jackpotPool * 0.6);

  players.filter(p => p.id !== roundWinner.id).forEach(p => {
    p.totalScore += p.lastScore;
  });

  // Update total scores
  players.forEach(p => {
    document.getElementById(`tscore-${p.id}`).textContent = p.totalScore.toLocaleString();
  });

  // Visual feedback
  document.getElementById(`slot-${roundWinner.id}`).classList.add('round-winner');
  document.getElementById(`avatar-${roundWinner.id}`).style.transform = 'scale(1.3)';
  setTimeout(() => document.getElementById(`avatar-${roundWinner.id}`).style.transform = '', 1000);

  players.forEach(p => {
    const reactionEl = document.getElementById(`reaction-${p.id}`);
    if (p.id === roundWinner.id) {
      reactionEl.textContent = 'üéâ';
      reactionEl.classList.add('jump');
    } else if (p.lastScore >= maxScore * 0.8) {
      reactionEl.textContent = 'üò§';
    } else {
      reactionEl.textContent = 'üòû';
      reactionEl.classList.add('shake');
    }
    document.getElementById(`slot-${p.id}`).classList.toggle('loser', p.id !== roundWinner.id);
  });

  // Banner
  const banner = document.getElementById('round-banner');
  banner.textContent = `üèÜ ${roundWinner.name} wins Round ${currentRound}! +${jackpotAward.toLocaleString()} JACKPOT BONUS!`;
  banner.className = 'show';

  // History
  roundHistory.push({ round: currentRound, winner: roundWinner.name, prize: jackpotAward });
  renderHistory();

  // Particles if jackpot
  if (roundWinner.lastCombo === 'jackpot' || jackpotAward > 300) spawnParticles();

  // Leaderboard
  renderLeaderboard();
  updateStats();
  document.getElementById('jackpot-pool').textContent = `üí∞ ${jackpotPool.toLocaleString()}`;
  updateJackpotMeter();
  renderRoundPips();

  isSpinning = false;

  if (currentRound >= totalRounds) {
    setTimeout(showMatchEnd, 1500);
    return;
  }

  document.getElementById('round-info').textContent = `Round ${currentRound} done ‚Äî Next: Round ${currentRound + 1}`;
  if (!autoSpin) {
    document.getElementById('spin-btn').disabled = false;
  } else {
    autoTimer = setTimeout(doSpin, 2000);
  }
}

// ===== LEADERBOARD =====
function renderLeaderboard() {
  const sorted = [...players].sort((a, b) => b.totalScore - a.totalScore);
  const lb = document.getElementById('leaderboard');
  lb.innerHTML = '';
  sorted.forEach((p, i) => {
    const row = document.createElement('div');
    row.className = 'lb-row' + (i === 0 ? ' lb-first' : '');
    const rankColors = ['var(--gold)', '#C0C0C0', '#CD7F32'];
    const rankIcons = ['ü•á', 'ü•à', 'ü•â'];
    row.innerHTML = `
      <div class="lb-rank" style="color:${rankColors[i] || 'rgba(255,255,255,0.4)'}">${rankIcons[i] || (i+1)}</div>
      <div class="lb-avatar">${p.avatar}</div>
      <div class="lb-name" style="color:${i === 0 ? 'var(--gold)' : ''}">${p.name}</div>
      <div class="lb-score">${p.totalScore.toLocaleString()}</div>
      <div class="lb-wins">‚ö°${p.roundWins}W</div>
    `;
    lb.appendChild(row);

    // Update rank badge on slot
    const rankBadge = document.getElementById(`rank-${p.id}`);
    if (rankBadge) {
      rankBadge.textContent = `#${i+1}`;
      rankBadge.className = `rank-badge rank-${i+1}`;
    }
  });
}

function renderHistory() {
  const hist = document.getElementById('history-list');
  hist.innerHTML = '';
  [...roundHistory].reverse().slice(0, 6).forEach(h => {
    const el = document.createElement('div');
    el.className = 'hist-item';
    el.innerHTML = `
      <span class="hist-round">R${h.round}</span>
      <span class="hist-winner">${h.winner}</span>
      <span class="hist-prize">+${h.prize.toLocaleString()}</span>
    `;
    hist.appendChild(el);
  });
}

function renderRoundPips() {
  const pips = document.getElementById('round-pips');
  pips.innerHTML = '';
  for (let i = 0; i < totalRounds; i++) {
    const pip = document.createElement('div');
    if (i < currentRound) pip.className = 'pip done';
    else if (i === currentRound) pip.className = 'pip current';
    else pip.className = 'pip';
    pips.appendChild(pip);
  }
}

function updateStats() {
  const sorted = [...players].sort((a, b) => b.totalScore - a.totalScore);
  const human = players[0];
  const rank = sorted.findIndex(p => p.id === human.id) + 1;
  document.getElementById('stat-my-score').textContent = human.totalScore.toLocaleString();
  document.getElementById('stat-my-rank').textContent = `#${rank}`;
}

function updateJackpotMeter() {
  const pct = Math.min((jackpotPool / 2000) * 100, 100);
  document.getElementById('jackpot-meter-fill').style.width = `${pct}%`;
}

// ===== PARTICLES =====
function spawnParticles() {
  const container = document.getElementById('particles');
  const colors = [var_css('--gold'), var_css('--neon-pink'), var_css('--neon-cyan'), var_css('--neon-green'), '#fff'];
  for (let i = 0; i < 60; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = Math.random() * 10 + 4;
    p.style.cssText = `
      width: ${size}px;
      height: ${size}px;
      background: ${colors[Math.floor(Math.random() * colors.length)]};
      left: ${Math.random() * 100}vw;
      top: -${size}px;
      animation-duration: ${Math.random() * 2 + 1.5}s;
      animation-delay: ${Math.random() * 0.5}s;
    `;
    container.appendChild(p);
    setTimeout(() => p.remove(), 4000);
  }
}

function var_css(name) {
  const val = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
  return val || '#fff';
}

// ===== MATCH END =====
function showMatchEnd() {
  const sorted = [...players].sort((a, b) => b.totalScore - a.totalScore);
  const champ = sorted[0];

  document.getElementById('overlay-champion').textContent = champ.avatar;
  document.getElementById('overlay-title').textContent = champ.isHuman ? 'üèÜ YOU WIN! CHAMPION!' : 'TOURNAMENT OVER!';
  document.getElementById('overlay-name').textContent = champ.name;
  document.getElementById('overlay-score').textContent = `FINAL SCORE: ${champ.totalScore.toLocaleString()} pts ‚Ä¢ ${champ.roundWins} ROUND WINS`;

  const lbHtml = sorted.map((p, i) => {
    const icons = ['ü•á','ü•à','ü•â','4th','5th'];
    return `<div class="lb-row ${i===0?'lb-first':''}">
      <div class="lb-rank" style="font-size:1rem">${icons[i]||''}</div>
      <div class="lb-avatar">${p.avatar}</div>
      <div class="lb-name" style="flex:1;text-align:left;padding:0 8px">${p.name}</div>
      <div class="lb-score">${p.totalScore.toLocaleString()}</div>
    </div>`;
  }).join('');
  document.getElementById('overlay-lb').innerHTML = `<div class="lb-title">Final Standings</div>${lbHtml}`;

  document.getElementById('overlay').classList.add('show');
  spawnParticles();
  setTimeout(spawnParticles, 500);
  setTimeout(spawnParticles, 1000);
}

document.getElementById('replay-btn').addEventListener('click', () => {
  document.getElementById('overlay').classList.remove('show');
  document.getElementById('lobby').style.display = 'flex';
});

// ===== CONTROLS =====
document.getElementById('spin-btn').addEventListener('click', () => {
  if (!isSpinning) doSpin();
});

document.getElementById('auto-btn').addEventListener('click', () => {
  autoSpin = !autoSpin;
  const btn = document.getElementById('auto-btn');
  const status = document.getElementById('auto-status');
  if (autoSpin) {
    btn.classList.add('active');
    btn.textContent = '‚èπ STOP AUTO';
    status.textContent = 'Auto spinning...';
    if (!isSpinning && currentRound < totalRounds) {
      autoTimer = setTimeout(doSpin, 500);
    }
  } else {
    btn.classList.remove('active');
    btn.textContent = 'AUTO SPIN';
    status.textContent = 'Manual mode';
    if (autoTimer) clearTimeout(autoTimer);
    if (!isSpinning && currentRound < totalRounds) {
      document.getElementById('spin-btn').disabled = false;
    }
  }
});
</script>
</body>
</html>